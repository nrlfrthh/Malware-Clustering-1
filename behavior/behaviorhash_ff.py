import sys
import os
import time
import json
import re
import argparse
import traceback
from multiprocessing.dummy import Pool as ThreadPool
import requests

INTELLIGENCE_SEARCH_URL = 'https://www.virustotal.com/intelligence/search/programmatic/'
BEHAVIOR_URL            = 'https://www.virustotal.com/vtapi/v2/file/report'
THREADS_NUM             = 5
API_CAP_PER_MIN         = 40


def chunks(l, n):
    """Yield successive n-sized chunks from l."""
    for i in range(0, len(l), n):
        yield l[i:i + n]
        
        
        def main():

    parser = argparse.ArgumentParser(description='Download behavioral data from VirusTotal.')
    parser.add_argument('hash_file', type=str, help='Text file containing executable hashes.')
    parser.add_argument('output_folder', type=str, help='Target output folder to store downloaded behavioral data.')
    parser.add_argument('apikey', type=str, help='VirusTotal API key')
    args = parser.parse_args()

    valid_hash = re.compile(r'[0-9a-fA-F]{32,64}')

    TARGET_DIR = args.output_folder

    filename_list = []
    hash_list = []
